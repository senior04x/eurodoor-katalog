import{c as k,u as S,j as e,s as C}from"./index-DWxxd3Cp.js";import{r as l}from"./vendor-bd6wVIFv.js";import{m,w as E,x as z,X as P,U as D,h as q,t as U,y as _,S as B,d as L}from"./ui-CR5CjSar.js";import"./supabase-ByzS6PGn.js";function O({onNavigate:r}){const{user:s,updateProfile:j}=k();S();const[n,c]=l.useState(!1),[t,i]=l.useState({name:"",phone:""}),[o,f]=l.useState({totalOrders:0,totalSpent:0,memberDays:0}),[N,x]=l.useState(!0),y=async()=>{if(s)try{x(!0);const{data:a,error:h}=await C.from("orders").select("id, total_amount, status, created_at").eq("customer_email",s.email);if(h){console.error("Error fetching orders:",h);return}const u=a?.length||0,g=a?.reduce((b,d)=>d.status==="delivered"||d.status==="completed"?b+(d.total_amount||0):b,0)||0,p=Math.floor((Date.now()-new Date(s.created_at).getTime())/(1e3*60*60*24));f({totalOrders:u,totalSpent:g,memberDays:p}),console.log("ðŸ“Š User stats loaded:",{totalOrders:u,totalSpent:g,memberDays:p})}catch(a){console.error("Error loading user stats:",a)}finally{x(!1)}};l.useEffect(()=>{s&&(i({name:s.name||"",phone:s.phone||""}),y())},[s]);const w=async()=>{try{const a=await j(t);a.success?(c(!1),alert("Profil muvaffaqiyatli yangilandi!")):alert("Xatolik: "+a.error)}catch{alert("Profil yangilashda xatolik yuz berdi")}},v=()=>{i({name:s?.name||"",phone:s?.phone||""}),c(!1)};return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Mening Profilim"}),e.jsx("p",{className:"text-gray-300",children:"Shaxsiy ma'lumotlaringizni boshqaring"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Shaxsiy ma'lumotlar"}),n?e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:w,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Saqlash"})]}),e.jsxs("button",{onClick:v,className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"Bekor qilish"})]})]}):e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Tahrirlash"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Ism"}),n?e.jsx("input",{type:"text",value:t.name,onChange:a=>i({...t,name:a.target.value}),className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-white/40 transition-colors",placeholder:"Ismingizni kiriting"}):e.jsx("p",{className:"text-white font-medium",children:s.name||"Kiritilmagan"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Telefon raqami"}),n?e.jsx("input",{type:"tel",value:t.phone,onChange:a=>i({...t,phone:a.target.value}),className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-white/40 transition-colors",placeholder:"+998 90 123 45 67"}):e.jsx("p",{className:"text-white font-medium",children:s.phone||"Kiritilmagan"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),e.jsx("p",{className:"text-white font-medium",children:s.email}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Email o'zgartirib bo'lmaydi"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-500/20 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-orange-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Ro'yxatdan o'tgan sana"}),e.jsx("p",{className:"text-white font-medium",children:new Date(s.created_at).toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})}),e.jsxs(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Tezkor amallar"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>r("orders"),className:"w-full flex items-center space-x-3 px-4 py-3 bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 rounded-lg transition-colors",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:"Buyurtmalarim"})]}),e.jsxs("button",{onClick:()=>r("catalog"),className:"w-full flex items-center space-x-3 px-4 py-3 bg-green-600/20 hover:bg-green-600/30 text-green-300 rounded-lg transition-colors",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"Mahsulotlar"})]})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Statistika"}),N?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Buyurtmalar soni"}),e.jsx("div",{className:"w-8 h-4 bg-white/20 rounded animate-pulse"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Jami xarid"}),e.jsx("div",{className:"w-16 h-4 bg-white/20 rounded animate-pulse"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"A'zo bo'lgan"}),e.jsx("div",{className:"w-12 h-4 bg-white/20 rounded animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Buyurtmalar soni"}),e.jsx("span",{className:"text-white font-semibold",children:o.totalOrders})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Jami xarid"}),e.jsxs("span",{className:"text-white font-semibold",children:[o.totalSpent.toLocaleString("uz-UZ")," UZS"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"A'zo bo'lgan"}),e.jsxs("span",{className:"text-white font-semibold",children:[o.memberDays," kun"]})]})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Profil ko'rish uchun tizimga kiring"}),e.jsx("button",{onClick:()=>r("home"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Bosh sahifaga qaytish"})]})})}export{O as default};
