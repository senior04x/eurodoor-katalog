import{u as q,a as M,b as E,j as e}from"./index-D1bh6Jp5.js";import{r as i}from"./vendor-bd6wVIFv.js";import{p as h}from"./productsApi-DHKWMocX.js";import{u as z,o as A,R as Q,d as g,m as b,j as B,S as R}from"./ui-CR5CjSar.js";import"./supabase-ByzS6PGn.js";function O({onNavigate:p}){const{t:x}=q(),{addToCart:f}=M(),{showSuccess:u}=E(),j=z(),[l,d]=i.useState([]),[v,o]=i.useState(!0),[r,w]=i.useState(""),[n,N]=i.useState("all"),[c,y]=i.useState("all");i.useEffect(()=>{const s=async()=>{try{o(!0),console.log("🔄 Loading products...");const t=await h.getAllProducts();d(t),console.log("✅ Products loaded:",t.length)}catch(t){console.error("❌ Error loading products:",t),d([])}finally{o(!1)}};s();const a=h.subscribeToProducts(t=>{console.log("🔄 Products updated:",t),s()});return()=>{a.unsubscribe()}},[]),i.useEffect(()=>{const s=()=>{document.hidden||(console.log("🔄 Page became visible, reloading products..."),(async()=>{try{o(!0);const t=await h.getAllProducts(!0);d(t),console.log("✅ Products reloaded:",t.length)}catch(t){console.error("❌ Error reloading products:",t)}finally{o(!1)}})())};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[]);const m=i.useMemo(()=>{let s=l;return r&&(s=s.filter(a=>a.name.toLowerCase().includes(r.toLowerCase())||a.material.toLowerCase().includes(r.toLowerCase())||a.description?.toLowerCase().includes(r.toLowerCase()))),n!=="all"&&(s=s.filter(a=>a.dimensions?.toLowerCase().includes(n.toLowerCase()))),c!=="all"&&(s=s.filter(a=>a.material.toLowerCase().includes(c.toLowerCase()))),s},[l,r,n,c]),k=i.useMemo(()=>["all",...new Set(l.map(a=>a.dimensions).filter(Boolean))],[l]),C=i.useMemo(()=>["all",...new Set(l.map(a=>a.material))],[l]),P=s=>{if(s.stock<=0){u("Xatolik!","Bu mahsulot omborda yo'q");return}const a={id:s.id,name:s.name,price:s.price,image:s.image||s.image_url||"",dimensions:s.dimensions,material:s.material,stock:s.stock};f(a),u("Mahsulot qo'shildi!",`${s.name} korzinkaga qo'shildi`)},L={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},S={hidden:{opacity:0,y:20,scale:.95},show:{opacity:1,y:0,scale:1,transition:j?{duration:0}:{type:"spring",stiffness:300,damping:20}}};return v?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-cover bg-center",style:{backgroundImage:"url('https://iili.io/KqAQo3g.jpg')"}}),e.jsx("div",{className:"fixed inset-0 bg-black/30"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Mahsulotlar yuklanmoqda..."})]})})]}):e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-cover bg-center",style:{backgroundImage:"url('https://iili.io/KqAQo3g.jpg')"}}),e.jsx("div",{className:"fixed inset-0 bg-black/30"}),e.jsx("section",{className:"bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl py-16 mx-4 rounded-3xl border border-white/20 shadow-2xl",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-white mb-4 bg-gradient-to-r from-white via-blue-100 to-purple-100 bg-clip-text text-transparent",children:x("catalog.title")}),e.jsx("p",{className:"text-lg text-gray-300 max-w-2xl mx-auto",children:x("catalog.description")})]})})}),e.jsx("section",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Mahsulot qidirish...",value:r,onChange:s=>w(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("select",{value:n,onChange:s=>N(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 appearance-none",children:k.map(s=>e.jsx("option",{value:s,className:"bg-gray-800 text-white",children:s==="all"?"Barcha o'lchamlar":s},s))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("select",{value:c,onChange:s=>y(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 appearance-none",children:C.map(s=>e.jsx("option",{value:s,className:"bg-gray-800 text-white",children:s==="all"?"Barcha materiallar":s},s))})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-gray-300",children:[m.length," ta mahsulot topildi"]})})]})}),e.jsx("section",{className:"container mx-auto px-4 pb-16",children:m.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-8",children:[e.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Mahsulot topilmadi"}),e.jsx("p",{className:"text-gray-300",children:"Qidiruv shartlarini o'zgartiring yoki boshqa kategoriyani tanlang"})]})}):e.jsx(b.div,{variants:L,initial:"hidden",animate:"show",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(s=>e.jsxs(b.div,{variants:S,className:"bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-3xl shadow-xl overflow-hidden border border-white/20 hover:border-blue-500/50 transition-all duration-300 hover:scale-105 group",children:[e.jsxs("div",{className:"relative aspect-square overflow-hidden",children:[e.jsx("img",{src:s.image||s.image_url||"https://picsum.photos/400/300?random=1",alt:s.name,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-300 transition-colors",children:s.name}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Material:"}),e.jsx("span",{className:"ml-2",children:s.material})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Xavfsizlik:"}),e.jsx("span",{className:"ml-2",children:s.security})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"O'lcham:"}),e.jsx("span",{className:"ml-2",children:s.dimensions})]})]}),s.description&&e.jsx("p",{className:"text-gray-300 text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[s.price.toLocaleString()," ",s.currency]}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Qoldiq: ",s.stock," dona"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{console.log("🔍 CatalogPage: Navigating to product detail:",s.id),p("product-detail",s.id)},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors",title:"Batafsil ko'rish",children:e.jsx(B,{className:"w-5 h-5 text-white"})}),e.jsx("button",{onClick:()=>P(s),disabled:s.stock<=0,className:`p-2 rounded-lg transition-colors ${s.stock<=0?"bg-gray-500/20 cursor-not-allowed opacity-50":"bg-blue-500/20 hover:bg-blue-500/30"}`,title:s.stock<=0?"Omborda yo'q":"Korzinkaga qo'shish",children:e.jsx(R,{className:"w-5 h-5 text-white"})})]})]})]})]},s.id))})})]})}export{O as default};
