import{s as l,u as C,a as q,c as P,b as $,j as e}from"./index-Dri8ZuAO.js";import{r as p}from"./vendor-bd6wVIFv.js";import{u as O,m,q as I,S as A,n as z,r as y,e as B,I as L,s as M,p as R,j as T}from"./ui-DElh6nK7.js";import"./supabase-ByzS6PGn.js";const U={async createOrder(s){try{const r={order_number:`EURO-${Date.now().toString().slice(-6)}`,customer_name:s.customer_name,customer_phone:s.customer_phone,customer_email:s.customer_email,delivery_address:s.delivery_address,notes:s.notes,total_amount:s.total_amount,products:s.products,status:"pending"},{data:n,error:d}=await l.from("orders").insert([r]).select().single();if(d)throw console.error("❌ Supabase error creating order:",d),new Error(`Supabase error: ${d.message}`);return n}catch(t){throw console.error("❌ Error creating order:",t),t}},async getOrderByNumber(s){try{const{data:t,error:r}=await l.from("orders").select("*").eq("order_number",s).single();return r?(console.error("❌ Supabase error fetching order:",r),null):t}catch(t){return console.error("❌ Error fetching order:",t),null}},async getOrdersByCustomer(s){try{const{data:t,error:r}=await l.from("orders").select("*").eq("customer_phone",s).order("created_at",{ascending:!1});if(r)throw console.error("❌ Supabase error fetching customer orders:",r),new Error(`Supabase error: ${r.message}`);return t||[]}catch(t){throw console.error("❌ Error fetching customer orders:",t),t}},async getAllOrders(){try{const{data:s,error:t}=await l.from("orders").select("*").order("created_at",{ascending:!1});if(t)throw console.error("❌ Supabase error fetching all orders:",t),new Error(`Supabase error: ${t.message}`);return s||[]}catch(s){throw console.error("❌ Error fetching all orders:",s),s}},async updateOrderStatus(s,t){try{const{error:r}=await l.from("orders").update({status:t}).eq("id",s);if(r)throw console.error("❌ Supabase error updating order status:",r),new Error(`Supabase error: ${r.message}`);return!0}catch(r){throw console.error("❌ Error updating order status:",r),r}},async getOrderItems(s){try{const{data:t,error:r}=await l.from("order_items").select("*").eq("order_id",s).order("created_at",{ascending:!0});if(r)throw console.error("❌ Supabase error fetching order items:",r),new Error(`Supabase error: ${r.message}`);return t||[]}catch(t){throw console.error("❌ Error fetching order items:",t),t}},subscribeToOrders(s){return l.channel("orders").on("postgres_changes",{event:"*",schema:"public",table:"orders"},s).subscribe()}},F={async createCustomer(s){try{const{data:t,error:r}=await l.from("customers").insert([s]).select().single();if(r)throw console.error("❌ Supabase error creating customer:",r),new Error(`Supabase error: ${r.message}`);return t}catch(t){throw console.error("❌ Error creating customer:",t),t}},async getCustomerByPhone(s){try{const{data:t,error:r}=await l.from("customers").select("*").eq("phone",s).single();return r?(console.error("❌ Supabase error fetching customer:",r),null):t}catch(t){return console.error("❌ Error fetching customer:",t),null}},async updateCustomer(s,t){try{const{error:r}=await l.from("customers").update(t).eq("id",s);if(r)throw console.error("❌ Supabase error updating customer:",r),new Error(`Supabase error: ${r.message}`);return!0}catch(r){throw console.error("❌ Error updating customer:",r),r}},async upsertCustomer(s){try{const t=await this.getCustomerByPhone(s.phone);if(t)return await this.updateCustomer(t.id,s),{...t,...s};{const r=await this.createCustomer(s);if(!r)throw new Error("Failed to create customer");return r}}catch(t){throw console.error("❌ Error upserting customer:",t),t}},async getAllCustomers(){try{const{data:s,error:t}=await l.from("customers").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw console.error("❌ Supabase error fetching all customers:",t),new Error(`Supabase error: ${t.message}`);return s||[]}catch(s){throw console.error("❌ Error fetching all customers:",s),s}},subscribeToCustomers(s){return l.channel("customers").on("postgres_changes",{event:"*",schema:"public",table:"customers"},s).subscribe()}};function V({onNavigate:s}){const t=O(),{t:r}=C(),{items:n,totalPrice:d,clearCart:N}=q(),{user:h}=P(),{showError:v}=$(),[o,b]=p.useState(null),[f,j]=p.useState(!1);p.useEffect(()=>{const a=localStorage.getItem("selectedProduct");if(a)try{const i=JSON.parse(a);b(i),g(w=>({...w,product:i.name}))}catch(i){console.error("Error parsing selected product:",i)}},[]);const[c,g]=p.useState({name:h?.name||"",phone:h?.phone||"",email:h?.email||"",product:"",message:"",delivery_address:""});p.useEffect(()=>{(async()=>{})()},[]);const _=async a=>{a.preventDefault(),j(!0);try{await F.upsertCustomer({name:c.name,phone:c.phone,email:c.email});const i=await U.createOrder({customer_name:c.name,customer_phone:c.phone,customer_email:c.email,delivery_address:c.delivery_address,notes:c.message,total_amount:n.length>0?d:o?.price||0,products:n.length>0?n:o?[{name:o.name,price:o.price,quantity:1,image:o.image,dimensions:o.dimensions,color:o.color,material:o.material}]:[]});if(i){const w={orderNumber:i.order_number,customerName:c.name,customerPhone:c.phone,totalAmount:n.length>0?d:o?.price||0};localStorage.setItem("lastOrderData",JSON.stringify(w));try{console.log("🔔 Order status watching started for:",i.order_number)}catch(E){console.error("Error starting order status watching:",E)}g({name:h?.name||"",phone:h?.phone||"",email:h?.email||"",product:"",message:"",delivery_address:""}),N(),b(null),localStorage.removeItem("selectedProduct"),s&&s("order-success")}}catch(i){console.error("❌ Error submitting order:",i),v("Xatolik yuz berdi!","Buyurtma yuborishda xatolik yuz berdi. Qaytadan urinib ko'ring.")}finally{j(!1)}},u=a=>{g({...c,[a.target.name]:a.target.value})},S=()=>{o&&s?(console.log("🔍 ContactPage: Navigating back to product detail:",o.id),s("product-detail",o.id)):s&&s("catalog")},k={hidden:{},show:{transition:t?{}:{when:"beforeChildren"}}},x={hidden:{opacity:0,y:40},show:{opacity:1,y:0,transition:t?{duration:0}:{duration:.9,ease:"easeOut"}}};return e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-cover bg-center",style:{backgroundImage:"url('https://iili.io/KqAQo3g.jpg')"}}),e.jsx("div",{className:"fixed inset-0 bg-black/30"}),e.jsxs(m.main,{variants:k,initial:"hidden",animate:"show",className:"relative",children:[!o&&e.jsx(m.section,{variants:x,className:"bg-white/10 backdrop-blur-xl rounded-2xl mx-4 py-16 shadow-2xl border border-white/20 mb-0",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:r("contact.title")}),e.jsx("p",{className:"text-lg text-white/90 max-w-2xl mx-auto",children:r("contact.description")})]})})}),o&&s&&e.jsx(m.section,{variants:x,className:"py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("button",{onClick:S,className:"bg-white/20 backdrop-blur-xl text-white px-6 py-3 rounded-xl hover:bg-white/30 transition-all duration-300 flex items-center gap-3 border border-white/30 shadow-lg hover:shadow-xl",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:r("contact.back_to_product")})]})})}),(n.length>0||o)&&e.jsx("section",{className:"py-8",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"h-5 w-5 text-white"}),e.jsx("h4",{className:"font-semibold text-white",children:n.length>0?`${r("contact.cart_items")} (${n.length})`:r("contact.selected_product")})]}),n.length>0?e.jsxs("div",{className:"space-y-4",children:[n.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:a.image,alt:a.name,className:"w-12 h-12 object-cover rounded-md"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:a.name}),e.jsxs("p",{className:"text-gray-300 text-sm",children:[a.dimensions&&`${r("contact.dimensions")}: ${a.dimensions}`,a.color&&` | ${r("contact.color")}: ${a.color}`]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-semibold",children:[a.price.toLocaleString()," UZS"]}),e.jsxs("p",{className:"text-gray-300 text-sm",children:[r("contact.quantity"),": ",a.quantity]})]})]},i)),e.jsx("div",{className:"border-t border-white/20 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-semibold text-white",children:[r("contact.total"),":"]}),e.jsxs("span",{className:"text-xl font-bold text-blue-400",children:[d.toLocaleString()," UZS"]})]})})]}):o?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"h-5 w-5 text-white"}),e.jsx("h4",{className:"font-semibold text-white",children:o.name})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-300",children:[r("contact.material"),":"]}),e.jsx("span",{className:"text-white",children:o.material})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-300",children:[r("contact.security"),":"]}),e.jsx("span",{className:"text-white",children:o.security})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-300",children:[r("contact.dimensions"),":"]}),e.jsx("span",{className:"text-white",children:o.dimensions})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-300",children:[r("contact.price"),":"]}),e.jsx("span",{className:"text-white font-semibold",children:o.price})]})]})]})}):null]})})}),e.jsx(m.div,{variants:x,className:"py-12 mt-0",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12",children:[e.jsxs(m.div,{variants:x,className:"w-full bg-white/10 backdrop-blur-xl rounded-2xl p-6 py-16 shadow-2xl border border-white/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:r(o?"contact.order_form":"contact.contact_form")}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:r("contact.name_placeholder"),value:c.name,onChange:a=>u(a),name:"name",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:border-white/40 transition-colors",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"tel",placeholder:r("contact.phone_placeholder"),value:c.phone,onChange:a=>u(a),name:"phone",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:border-white/40 transition-colors",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"email",placeholder:r("contact.email_placeholder"),value:c.email,onChange:a=>u(a),name:"email",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:border-white/40 transition-colors",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:r("contact.delivery_address_placeholder"),value:c.delivery_address,onChange:a=>u(a),name:"delivery_address",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:border-white/40 transition-colors",required:!0})}),e.jsx("div",{children:e.jsx("textarea",{placeholder:r("contact.message_placeholder"),value:c.message,onChange:a=>u(a),name:"message",rows:4,className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:border-white/40 transition-colors resize-none"})}),e.jsxs("button",{type:"submit",disabled:f,className:"w-full bg-white/20 text-white py-3 px-6 rounded-lg font-semibold hover:bg-white/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-300 flex items-center justify-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),f?r("contact.sending"):n.length>0?r("contact.place_order"):r(o?"contact.place_order":"contact.send_message")]})]})]}),e.jsxs(m.div,{variants:x,className:"w-full bg-white/10 backdrop-blur-xl rounded-2xl p-6 py-16 shadow-2xl border border-white/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:r("contact.contact_info")}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(B,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:r("contact.phone")}),e.jsx("a",{href:"tel:+998901234567",className:"text-white hover:underline",children:"+998 90 123 45 67"})," ",e.jsx("br",{}),e.jsx("a",{href:"tel:+998912345678",className:"text-white hover:underline",children:"+998 91 234 56 78"})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:r("contact.telegram")}),e.jsx("a",{href:"https://t.me/eurodoor_uz",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:underline",children:r("contact.telegram_handle")})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(L,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:r("contact.instagram")}),e.jsx("a",{href:"https://instagram.com/eurodoor.uz",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:underline",children:r("contact.instagram_handle")})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:r("contact.email")}),e.jsx("p",{className:"text-white",children:r("contact.email_address")})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(R,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:r("contact.our_location")}),e.jsxs("p",{className:"text-white",children:[r("contact.address_detail"),", ",e.jsx("br",{}),r("contact.address_street")]})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(T,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:r("contact.working_hours")}),e.jsxs("p",{className:"text-white",children:[r("contact.working_hours_weekdays")," ",e.jsx("br",{}),r("contact.working_hours_weekend")]})]})]})]})]})]})})})]})]})}export{V as default};
